---
tags: [type/guide, dev/payment, methodology/workflow, status/completed]
created: 2026-02-05
---

# 키움페이(KiwoomPay) 통합 결제 구축 가이드

> 작성일: 2026-02-05 (업데이트)
> 프로젝트: `C:\JohnCodeQ\kiwoom-billing\`
> GitHub: https://github.com/keyfream7001/kiwoom-billing

## 📊 가맹점 상태
- ✅ 키움페이 심사 완료
- ✅ 카드결제: 실결제 가능
- ⏳ 카카오페이: 승인 대기중
- ⏳ 네이버페이: 승인 대기중

---

## 📌 개요

키움페이의 정기결제(Billing) 시스템은 **빌링키** 방식으로 작동한다.
- 카드정보 → 빌링키 발급 → 빌링키로 반복 결제

## 🔗 공식 문서

- **개발자센터**: https://developer.kiwoompay.co.kr/
- **통합API 가이드**: https://developer.kiwoompay.co.kr/developer/guide_api
- **API 매뉴얼 다운로드**: https://developer.kiwoompay.co.kr/download/developer/KIWOOMPAY_API.zip

## 🛠️ 연동 플로우

### 1단계: Ready URL 요청
```
POST https://apitest.kiwoompay.co.kr/pay/ready (테스트)
POST https://api.kiwoompay.co.kr/pay/ready (운영)

Headers:
  Authorization: {KIWOOM_AUTH_KEY}
  Content-Type: application/json;charset=EUC-KR

Body:
{
  "CPID": "{가맹점ID}",
  "PAYMETHOD": "CARD-KEYGEN"  // 빌링키 발급
}

Response:
{
  "RETURNURL": "결제 API URL",
  "TOKEN": "요청 토큰"
}
```

### 2단계: 빌링키 발급
```
POST {RETURNURL}

Headers:
  Authorization: {KIWOOM_AUTH_KEY}
  TOKEN: {위에서 받은 TOKEN}

Body:
{
  "CPID": "{가맹점ID}",
  "PAYMETHOD": "CARD-KEYGEN",
  "ORDERNO": "주문번호",
  "CARDNO": "카드번호 16자리",
  "EXPIREDT": "유효기간 YYMM",
  "CARDPWD": "비밀번호 앞 2자리",
  "CARDAUTH": "생년월일 YYMMDD 또는 사업자번호",
  ...
}

Response (성공):
{
  "RESULTCODE": "0000",
  "BILLKEY": "발급된 빌링키",
  ...
}
```

### 3단계: 빌링키로 결제
```
PAYMETHOD: "CARD-BATCH"
Body에 BILLKEY, AMOUNT 포함
```

## 📋 결제수단 코드 (PAYMETHOD)

| 코드 | 설명 |
|------|------|
| `CARD-KEYGEN` | 빌링키 발급 |
| `CARD-BATCH` | 정기결제 실행 |
| `CARDK-KEYGEN` | 빌링키 발급 (K) |
| `CARDK-BATCH` | 정기결제 실행 (K) |
| `CARD-SUGI` | 수기결제 |

## 🔐 인증 방식

- **Authorization 헤더**: 키움페이에서 발급받은 연동키
- **TOKEN**: Ready API에서 받은 요청별 토큰

## 📡 웹훅 처리

키움페이는 결제 결과를 **Noti(통지전문)** 방식으로 전송한다.
- 결제 성공/실패 시 가맹점 서버로 POST 요청
- 반드시 `RESULTCODE: "0000"` 응답 필요

```json
// 웹훅 요청 예시
{
  "RESULTCODE": "0000",
  "DAOUTRX": "거래번호",
  "ORDERNO": "주문번호",
  "AMOUNT": "결제금액",
  "AUTHDATE": "결제일시"
}

// 가맹점 응답 (필수)
{
  "RESULTCODE": "0000",
  "RESULTMSG": "OK"
}
```

## 🗂️ 프로젝트 구조

```
kiwoom-billing/
├── src/
│   ├── index.ts              # Express 서버
│   ├── config/index.ts       # 환경변수 설정
│   ├── services/kiwoomPay.ts # 키움페이 API 서비스
│   ├── routes/billing.ts     # 빌링 API 라우트
│   ├── routes/webhook.ts     # 웹훅 처리
│   └── types/index.ts        # TypeScript 타입
└── package.json
```

## 🚀 실행 방법

```bash
cd C:\JohnCodeQ\kiwoom-billing
npm install
cp .env.example .env  # 환경변수 설정
npm run dev           # 개발 서버
```

## ⚠️ 주의사항

1. **테스트/운영 URL 구분**
   - 테스트: `https://apitest.kiwoompay.co.kr`
   - 운영: `https://api.kiwoompay.co.kr`

2. **카드정보 보안**
   - 카드번호는 서버에 저장 X
   - 빌링키만 저장하여 사용

3. **인코딩**
   - 일부 API는 `EUC-KR` 인코딩 사용

4. **가맹점 계약 필요**
   - CPID, AUTH_KEY는 키움페이 계약 후 발급

## 📱 간편결제 (통합결제창 SDK)

키움페이 통합결제창을 통해 간편결제 연동 가능

### 지원 결제수단
| 결제수단 | 상태 | 비고 |
|---------|------|------|
| 카카오페이 | ⏳ 승인 대기 | 코드 준비 완료 |
| 네이버페이 | ⏳ 승인 대기 | 코드 준비 완료 |
| 삼성페이 | 🔧 구현됨 | 비활성화 |
| 페이코 | 🔧 구현됨 | 비활성화 |

### SDK 연동 방식
```javascript
// 1. SDK 로드
<script src="https://ssl-v2.kiwoompay.co.kr/sdk/v1/latest/kiwoompayEnc.js"></script>

// 2. 초기화
KiwoomPaySDK.f_setInit('DEV', 'FRAME');  // DEV/REAL, FRAME/공백

// 3. 서버에서 KIWOOM_ENC 해시 발급
POST /easypay/prepare → { sdkData: { KIWOOM_ENC, ... } }

// 4. 결제창 호출
KiwoomPaySDK.f_payTotalLink(sdkData);
```

### 환경 분리
```env
# 개발
NODE_ENV=development
KIWOOM_TEST_API_URL=https://apitest.kiwoompay.co.kr
KIWOOM_TEST_AUTH_KEY=테스트키

# 운영
NODE_ENV=production
KIWOOM_PROD_API_URL=https://api.kiwoompay.co.kr
KIWOOM_PROD_AUTH_KEY=운영키

# 간편결제 활성화
KAKAOPAY_ENABLED=true
NAVERPAY_ENABLED=true
```

## 🔗 API 엔드포인트 요약

### 카드 정기결제
- `POST /billing/register` - 빌링키 등록
- `POST /billing/subscribe` - 정기결제 등록
- `POST /billing/pay` - 결제 실행
- `POST /billing/cancel` - 구독 취소

### 간편결제
- `GET /easypay/methods` - 활성화된 결제수단
- `POST /easypay/prepare` - 결제 준비 (SDK 데이터)
- `POST /easypay/cancel` - 결제 취소
- `GET /easypay/sdk-example` - SDK 예제

### 웹훅
- `POST /webhook/kiwoom` - 결제 결과 수신

## 📝 TODO

- [ ] 데이터베이스 연동 (PostgreSQL/MongoDB)
- [ ] 결제 스케줄러 구현 (정기 결제 자동 실행)
- [ ] 결제 실패 재시도 로직
- [ ] 이메일/알림 발송
- [ ] 카카오페이/네이버페이 승인 후 테스트

---

#결제 #정기결제 #키움페이 #빌링키 #카카오페이 #네이버페이 #간편결제 #API연동
